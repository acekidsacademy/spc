<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>The SPC project &#8212; SPC 0.33 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.33',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SPC 0.33 documentation" href="#" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="the-spc-project">
<h1>The SPC project<a class="headerlink" href="#the-spc-project" title="Permalink to this headline">¶</a></h1>
<p>The Scientific Platform for the Cloud (SPC) is a cloud platform for easily migrating and running scientific applications in the cloud. It is described in more detail in the following paper:</p>
<p>&gt; W Brewer, W Scott, and J Sanford, “An Integrated Cloud Platform for Rapid Interface Generation, Job Scheduling, Monitoring, Plotting, and Case Management of Scientific Applications”, Proc. of the International Conference on Cloud Computing Research and Innovation, Singapore, IEEE Press, October 2015, pp. 156-165, doi:10.1109/ICCCRI.2015.24 http://ieeexplore.ieee.org/document/7421906/</p>
<p>This platform is ideally suited to run scientific applications that: (1) require an input deck full of integers, floats, strings, and booleans stored in a standardized file format such as INI, XML, JSON, YAML, or Namelist.input, (2) require some amount of processing time (i.e. not instantaneous &#8211; although it can handle such cases too), (3) require some plotting at the end of the simulation, (4) use MPI or MapReduce for parallelization (although handles serial cases well too). Moreover, it can handle other applications as well, but some amount of pre- or post-processing may be required. Such topics are described in more detail in the aforementioned paper. If you need a copy of this paper, please send an e-mail request to the address at the bottom of this file.</p>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>The latest version of SPC can be downloaded from <a class="reference external" href="https://bitbucket.org/whbrewer/spc">https://bitbucket.org/whbrewer/spc</a>.  This was developed using Python 2.7 for compatibility with other modules, and thus is not currently compatible with Python 3.</p>
<p>Currently, SPC cannot be installed as a typical application but simply runs from wherever the directory is located.  To setup SPC, one needs to first generate a database, and also a Python configuration file (src/config.py) as follows:</p>
<blockquote>
<div>&gt; spc init</div></blockquote>
<p>To start running the server, then type:</p>
<blockquote>
<div>&gt; spc run</div></blockquote>
<p>This will start the web server listening on port 8580. Then, open your web browser to: <a class="reference external" href="http://localhost:8580/">http://localhost:8580/</a> (or <a class="reference external" href="http://127.0.0.1:8580">http://127.0.0.1:8580</a>, or <a class="reference external" href="http://0.0.0.0:8580">http://0.0.0.0:8580</a>).</p>
<p>“spc init” will also install a simple Python demo app called simply “dna”, which asks the user to input a string of DNA, and then will analyze its content.</p>
</div>
<div class="section" id="installing-apps">
<h2>Installing Apps<a class="headerlink" href="#installing-apps" title="Permalink to this headline">¶</a></h2>
<p>Adding apps can be accomplished in two ways: (1) interactively via the user interface, or (2) via the command-line options (see section on package management).</p>
<p>#### A. Manually adding app through user interface</p>
<p>To install or modify apps interactively, one must be logged in as user admin (default password admin).  Note, if user authentication is turned, off one will still need to login as admin, by clicking the hamburger icon , logging out, and then logging back in as admin.  Before this can happen,  enable authentication by setting “auth = True” in the src/config.py file.
To install an app interactively, click the Apps button, then click the +Add button.  Installation of an app requires five steps:</p>
<p><strong>Database entry setup</strong> – The first step is to store some basic information about the app into the database:</p>
<p><strong>Name</strong> – A unique name for the app, with no spaces or punctuation marks.
Description – Description of the app.  What does it do?
Input format – There are three possible options for input format: (1) namelist, (2) INI format, (3) XML format.  In the future, support may be added for JSON format as well.
Command – This is the command to run to start the simulation.  This command is being run from the working directory of the case, which is user_data/user/app/case (e.g. user_data/joe/mendel/c82d3f).   For example, this may look like:</p>
<blockquote>
<div>&lt;rel_apps_dir&gt;/mendel/mendel</div></blockquote>
<p>(or mendel.exe for a Windows machine).  Here &lt;rel_apps_dir&gt; will be later replaced by the location where the SPC apps are installed (currently this would replaced by the string ../../../../src/spc_apps). For a Java application, this may look like:</p>
<blockquote>
<div>/usr/bin/java -jar &lt;rel_apps_dir&gt;/jmendel/dist/jmendel.jar</div></blockquote>
<p>NOTE: since v0.22, the app run command can no longer be specified through the web interface.  It must instead be specified in the spc.json file.  Therefore, after setting up an, app, one may generate an spc.json manifest file by going in to the app configuration page (Click on top right “hamburger” icon and click “Configure app”, then click the “Export” button).  This will output a spc.json file to the src/spc_apps/appname folder.   Then, edit the command line in the  spc.json file to be something like (replacing app with the name of your app):</p>
<blockquote>
<div>&#8220;command&#8221;: &#8220;&lt;rel_apps_path&gt;/app/app&#8221;,</div></blockquote>
<p>After setting up the database entry, to finish setting up the application will require several more steps, which can be controlled from the App Edit page, which can be accessed by clicking the cog wheel on the App Edit page</p>
<p><strong>Upload input file</strong> – To accomplish this step, click the “Configure inputs” button, and following through the instructions. One must upload an input file that is consistent with the input format specified in step 1.  So, for example, if namelist input format is specified, the upload file must be in namelist format.  Also, the name of the input file should be the name of the app with the following extension:</p>
<ul class="simple">
<li>INI format &amp;rightarrow; appname.ini</li>
<li>XML format &amp;rightarrow; appname.xml</li>
<li>JSON format &amp;rightarrow; appname.json</li>
<li>YAML format &amp;rightarrow; appname.yaml</li>
<li>TOML format &amp;rightarrow; appname.toml</li>
<li>namelist.input &amp;rightarrow; appname.in (e.g. mendel.in)</li>
</ul>
<p><strong>Setup HTML template file</strong> – one of the things that the upload input file format does is to create an HTML template file, appname.tpl, in the views/apps folder.</p>
<p><strong>Static assets</strong> – It is also possible to include static assets such as JavaScript files, CSS files, etc. which currently cannot be uploaded through the web interface, but can be added later manually by copying the files to static/apps/appname.   They can be referenced later in the views/apps/appname.tpl, for example refer to the file mendel.js as follows:</p>
<blockquote>
<div>&lt;script src=&#8221;/static/apps/mendel/mendel.js&#8221;&gt;&lt;/script&gt;</div></blockquote>
<p><strong>Upload binary file</strong> – To upload a binary file, click the “Configure Executable” button.  Please note that the binary file must be compiled on the same operating system as the host machine running SPC.  So, for example, if SPC is running on an Amazon EC2 instance running 32-bit Linux with a certain glibc version, it should be compiled on an equivalent machine running the same glibc version.
Setup plots – To configure plots, click the “Configure Plots” button, then click “Add Plot”.  Each plot must have at least one datasource.  So, once a plot has been setup, one must click the “datasource” link connected with that plot, and then click the “Add Data Source” button.  While there are options for label, plot type, and color, these are all stored together in JSON format under one field in the database called data_def, short for data definition.</p>
<p>#### B. Adding app through SPC’s package management system</p>
<p>Because it may take some time to setup an app, especially the plots, it is possible to save the configuration as a JSON manifest file called spc.json.  Therefore, it is possible to create an SPC package of an app, which is simply a zipped archive containing the input file, binary, spc.json manifest file, and then make it available on the Internet (e.g. by hosting it on github.org or bitbucket.org).  In this way, anyone else running SPC can easily install your app by running the command:</p>
<blockquote>
<div>&gt; spc install <a class="reference external" href="http://url/to/package.zip">http://url/to/package.zip</a></div></blockquote>
<p>or by running the command on a file:</p>
<blockquote>
<div>&gt; spc install /path/to/package.zip</div></blockquote>
<p>For Mac OS X users, an example can be installed by running the following command:</p>
<blockquote>
<div>&gt; spc install <a class="reference external" href="https://github.com/whbrewer/fmendel-spc-osx/archive/master.zip">https://github.com/whbrewer/fmendel-spc-osx/archive/master.zip</a></div></blockquote>
<p>#### Pre-/Post-processing</p>
<p>The code for pre- and post-processing is in the processing.py file.  This feature can be turned on by setting the pre-processing option in the database setup to the input filename.  However, coding to handle the pre-processing step must be manually added to the processing.py file.</p>
<p>##### Pre-processing</p>
<p>The pre-processor is run just before starting the executable in the function execute() in main.py.  This feature is called as:</p>
<blockquote>
<div><dl class="docutils">
<dt>if myapps[app].preprocess:</dt>
<dd>run_params,_,_ = myapps[app].read_params(user,cid)
processed_inputs = process.preprocess(…)</dd>
</dl>
</div></blockquote>
<p>This feature can be used for things that need to be changed just before running.  Some examples:</p>
<ul>
<li><p class="first">Your program writes its output to a different file than appname.out, e.g. out100.00 where 100 is an entry input by the user in the input form.  Therefore you can add a couple lines in execute() such as:</p>
<blockquote>
<div><dl class="docutils">
<dt>if myapps[app].preprocess == &#8220;terra.in&#8221;:</dt>
<dd><p class="first last">myapps[app].outfn = &#8220;out&#8221;+run_params[&#8216;casenum&#8217;]+&#8221;.00&#8221;</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first">Your program doesn’t actually use an input file, but rather uses command line switches to control certain behavior.  Since SPC requires an input file to interact with the user interface, one can use the pre-processing option to convert a file that looks like:</p>
<blockquote>
<div><blockquote>
<div><p>[BASIC]
g_popsize = 100
o_polytype = NBH
…
[MUTATIONS]
f_del_prop = 0.9
h_dominance = 0.5
…</p>
</div></blockquote>
<p>to a file containing set of switches that the program reads:</p>
<blockquote>
<div><p>-x2 -s2 -n100 -v5 -r10 -k1 -i4 -j0.5 -f0.9 -g100 -oNBH -h0.5 -c5 -u5</p>
</div></blockquote>
<p>This was accomplished by adding the following code to the preprocess() function in process.py:</p>
<blockquote>
<div><p>if fn == &#8216;fpg.in&#8217;: ...</p>
</div></blockquote>
<p>This is not good practice, to embed code in the spc source code.  In the future, code hooks should be implemented to look for pre-process specific code in the installed app folder.</p>
</div></blockquote>
</li>
</ul>
<p>#### convert input key/value params to cmd-line style args</p>
<blockquote>
<div><dl class="docutils">
<dt>for key, value in (params.iteritems()):</dt>
<dd>option = &#8216;-&#8216; + key.split(&#8216;_&#8217;)[0] # extract 1st letter
buf += option + value + &#8216; &#8216;</dd>
</dl>
<p>sim_dir = os.path.join(base_dir,fn)
return _write_file(buf,sim_dir)</p>
</div></blockquote>
<p>The pre-processing option may also be used if one needs to write e.g. a PBS run script pbs.script file for running parallel applications via MPI.</p>
<p>#### Post-processing</p>
<p>The post-processor is called when the user clicks on any plot.  The post-processor may be used to convert raw output data into JSON form that is needed for a programs like the Flot JavaScript plotting program to plot the files correctly.   This function is defined in the file process.py.  Here is the doc string for the postprocess() function:</p>
<blockquote>
<div><dl class="docutils">
<dt>&#8220;&#8221;&#8220;return data as an array...</dt>
<dd>turn data that looks like this:
100   0.98299944  200    1.00444448   300    0.95629907
into something that looks like this:
[[100, 0.98299944], [200, 1.00444448], [300, 0.95629907], ... ]&#8221;&#8220;&#8221;</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="user-authentication">
<h2>User Authentication<a class="headerlink" href="#user-authentication" title="Permalink to this headline">¶</a></h2>
<p>User authentication can be enabled or disabled by setting the auth value in <cite>config.py</cite> to either True or False.   There are two default accounts that are setup when the running “spc init”.  They are: admin (password admin) and guest (password guest).  The admin user can install, configure apps, run cases, and also can manage other users accounts (presently this is just limited to deleting other accounts, but may in the future include some options such as setting the default priority level, or disk quotas, etc.).</p>
</div>
<div class="section" id="the-web-server">
<h2>The Web Server<a class="headerlink" href="#the-web-server" title="Permalink to this headline">¶</a></h2>
<p>Currently, SPC is setup to use Bottle’s built-in web server, which works fine as a development server, but not as a production server.  This can easily be changed to use a multi-threaded server such as cherrypy, bjoern, tornado, gae, etc. by changing the server variable in config.py, e.g.</p>
<blockquote>
<div>server = ‘cherrypy’</div></blockquote>
<p>Of course, this assumes that cherrypy has already been installed (e.g. sudo pip install cherrypy).</p>
</div>
<div class="section" id="the-job-scheduler">
<h2>The Job Scheduler<a class="headerlink" href="#the-job-scheduler" title="Permalink to this headline">¶</a></h2>
<p>SPC currently uses a multi-processing scheduler.  The scheduler uses Python’s multiprocessing module and includes synchronization primitives such as Lock (mutex) and a BoundedSemaphore for ensuring that only a user-specified number of jobs can run concurrently.  To change scheduler options, modify config.py.  It is important to set the number of jobs that you will allow to run concurrently by setting the np parameter in config.py, e.g.</p>
<blockquote>
<div>np = 2</div></blockquote>
<p><strong>np</strong> is short for number of processors, but really represents how many processors can be scheduled concurrently.  For example, if the value is 2, two jobs that require a single processor can be scheduled, or a single job that requires 2 processors can be scheduled.</p>
</div>
<div class="section" id="config-py-options">
<h2>config.py options<a class="headerlink" href="#config-py-options" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>auth</li>
<li>tab_title</li>
<li>submit_type</li>
<li>remote_worker_url</li>
<li>port</li>
<li>np</li>
</ul>
</div>
<div class="section" id="setting-up-mpi-based-applications">
<h2>Setting up MPI-based applications<a class="headerlink" href="#setting-up-mpi-based-applications" title="Permalink to this headline">¶</a></h2>
<p>Install MPI software (e.g. www.mpich.org)
In config.py, set the mpirun parameter, e.g.</p>
<blockquote>
<div>mpirun = &#8216;/usr/local/bin/mpiexec&#8217;</div></blockquote>
<p>In config.py, the np parameter has to be set to a value of greater than 1.
After clicking Start, then Continue, select the number of processors to use for this run:</p>
<p>For example, setting the value to 2, will execute the command:</p>
<blockquote>
<div>mpiexec –n 2 app.exe</div></blockquote>
</div>
<div class="section" id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>Notice, this is still a largely untested feature and still may be considered in alpha mode.</p>
<p>Docker may be used in conjunction with SPC to run remote jobs.  To use Docker with SPC, first docker (on Fedora/Centos, etc. “sudo yum update -y; sudo yum install docker” or on Ubuntu “sudo apt-get update; sudo apt-get install docker-ce”) and docker-py must be installed (“sudo pip install docker-py&#8221;).  Startup docker (“sudo service docker start”).  Thirdly, you should pull an Docker images that is running an SPC worker by running, e.g.</p>
<blockquote>
<div>docker pull whbrewer/spc</div></blockquote>
<p>Then, you can bring up the /docker view in SPC by clicking on the hamburger icon on the top right, and click the Docker option.  From there, you can create a container from the image by clicking the   icon under the docker images actions.  On creation you may specify host and container port numbers, but since the container version of SPC is listening on port 8581, best to just leave them as the defaults given.   Once you create the container, you will need to start it, so click the  icon.  The container should start running, and should be able to access from the browser using <a class="reference external" href="http://url:8581">http://url:8581</a> (e.g. <a class="reference external" href="http://localhost:8581">http://localhost:8581</a>) . The container version of SPC is running on port 8581, so that it doesn’t conflict with SPC running on the host.</p>
<p>One can schedule jobs from the host to run on the container by adding the following two options in the config.py such as:</p>
<blockquote>
<div>submit_type = “remote”
remote_worker_url = “localhost:8581”</div></blockquote>
<p>For this case, you will need to setup the container to as a worker node, which is explained next.</p>
<p>One can login to the Docker container and modify SPC to add new apps.  Once this is done, the container must be saved using “docker commit”.  One may also build their own Docker container by using an older version or starting from a Ubuntu base image.  In this case, you will need to  make a Dockerfile with contents such as:</p>
<blockquote>
<div>FROM bf6b7e57fba6
WORKDIR /root/spc
ENTRYPOINT [&#8220;python&#8221;, &#8220;spc&#8221;, &#8220;runworker&#8221;]</div></blockquote>
<p>Here, the FROM statement is the image that you are basing SPC on, possibly a previous SPC container, or an Ubuntu base image.  The third argument “runworker” can be just “run” if you want to run a regular SPC installation, or “runworker&#8221; if you want to just use it as a worker node, i.e. no user interface.  In this case, you can build the new image using a command such as:</p>
<blockquote>
<div>docker build -t spc .</div></blockquote>
</div>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<p>How to pass a hidden “case_id” value used in the interface into the file?</p>
<p>Create a variable called “case_id” in the input file (e.g. case.ini).  When you are uploading and parsing the input file and are asked to assign html entity types for each parameter, set the type to “hidden”.</p>
</div>
<div class="section" id="known-issues">
<h2>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<p>HTML input elements, which are disabled will cause problems.  In essence, they will be interpreted as checkboxes that are not checked, so the values will be set to F, which may cause problems when the simulation program tries to read the value and is expecting say an integer value.  Therefore, in lieu of using disabled=true on input tags, set readOnly=true.
The restart option does not work for apps that use XML input files.  This is a problem with the structure that is being output from SPC and needs to be fixed in the future.</p>
<p>Contents:</p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The SPC project</a><ul>
<li><a class="reference internal" href="#getting-started">Getting started</a></li>
<li><a class="reference internal" href="#installing-apps">Installing Apps</a></li>
<li><a class="reference internal" href="#user-authentication">User Authentication</a></li>
<li><a class="reference internal" href="#the-web-server">The Web Server</a></li>
<li><a class="reference internal" href="#the-job-scheduler">The Job Scheduler</a></li>
<li><a class="reference internal" href="#config-py-options">config.py options</a></li>
<li><a class="reference internal" href="#setting-up-mpi-based-applications">Setting up MPI-based applications</a></li>
<li><a class="reference internal" href="#docker">Docker</a></li>
<li><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
<li><a class="reference internal" href="#known-issues">Known Issues</a></li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Wesley Brewer.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/index.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>